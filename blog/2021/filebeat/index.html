<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Filebeat | Deepak Gouda</title> <meta name="author" content="Deepak Gouda"/> <meta name="description" content="Setting up Filebeat module of ELK stack [Part 2]."/> <meta name="keywords" content="academic-website, portfolio-website"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="/assets/img/title-icon.png"/> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://deepakgouda.github.io/blog/2021/filebeat/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="https://deepakgouda.github.io/"><span class="font-weight-bold">Deepak</span> Gouda</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/shots/">shots</a> </li> <li class="nav-item "> <a class="nav-link" href="/gallery/">gallery</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/talks/">talks</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/genealogy/">genealogy</a> <a class="dropdown-item" href="/checklist/">checklist</a> </div> </li> <div class="toggle-container"> <a id="light-toggle"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </a> </div> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Filebeat</h1> <p class="post-meta">February 23, 2021</p> <p class="post-tags"> <a href="/blog/2021"> <i class="fas fa-calendar fa-sm"></i> 2021 </a>   ·   <a href="/blog/tag/tech"> <i class="fas fa-hashtag fa-sm"></i> tech</a>   <a href="/blog/tag/framework"> <i class="fas fa-hashtag fa-sm"></i> framework</a>   <a href="/blog/tag/setup"> <i class="fas fa-hashtag fa-sm"></i> setup</a>     ·   <a href="/blog/category/Setup"> <i class="fas fa-tag fa-sm"></i> Setup</a>   </p> </header> <article class="post-content"> <p>This article is the second module of the <strong>Self-managed ELK Stack</strong> article behind <a href="https://www.deepakgouda.com/Self-managed-ELK-Stack" target="_blank" rel="noopener noreferrer">Introduction</a> . Hence, it is recommended to go through the aforementioned article before proceeding with Filebeat.</p> <p>Filebeat, being the most commonly used beat has been explained here. Filebeat has to be installed on all the systems which produce logs. Filebeat collects the logs and ships them to Elasticsearch from where Kibana pulls the data for visualization.</p> <h3 id="1-install">1. Install</h3> <p>Instructions provided for <a href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-installation-configuration.html#installation" target="_blank" rel="noopener noreferrer">all major OS as well as Docker and Kubernetes</a>.</p> <p>Install filebeat version 7.8.1 on Debian</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-L</span> <span class="nt">-O</span> https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.8.1-amd64.deb
<span class="nb">sudo </span>dpkg <span class="nt">-i</span> filebeat-7.8.1-amd64.deb
</code></pre></div></div> <h3 id="2-connect-to-elastic-stack">2. Connect to Elastic Stack</h3> <p>Edit /etc/filebeat/filebeat.yml</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">setup.kibana</span><span class="pi">:</span>
  <span class="na">host</span><span class="pi">:</span> <span class="s2">"</span><span class="s">&lt;kibana_ip&gt;:5601"</span> <span class="c1"># kibana ip and port</span>

<span class="na">output.elasticsearch</span><span class="pi">:</span>
  <span class="na">hosts</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">&lt;es_ip&gt;:9200"</span><span class="pi">]</span> <span class="c1"># elasticsearch ip and port</span>

  <span class="na">username</span><span class="pi">:</span> <span class="s2">"</span><span class="s">elastic"</span>
  <span class="na">password</span><span class="pi">:</span> <span class="s2">"</span><span class="s">&lt;add</span><span class="nv"> </span><span class="s">password&gt;"</span>

</code></pre></div></div> <h3 id="3-list-and-enable-modules">3. List and enable modules</h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>filebeat modules list
filebeat modules enable system nginx mysql
</code></pre></div></div> <p>Configure <code class="language-plaintext highlighter-rouge">/etc/filebeat/modules.d/&lt;module&gt;.yml</code> file</p> <p>Add the path to log files in <code class="language-plaintext highlighter-rouge">/etc/filebeat/filebeat.yml</code></p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">filebeat.inputs</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">log</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">paths</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">/path/to/logs/*.log</span> <span class="c1"># load data from the corresponding path</span>
  <span class="na">ignore_older</span><span class="pi">:</span> <span class="s">17h</span>       <span class="c1"># ignore files created before the specified relative time</span>
</code></pre></div></div> <p>Multiple files with separate tags/configs</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">filebeat.inputs</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">log</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">paths</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">/path/to/data/*.csv</span>
  <span class="na">tags</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">csv-type-x"</span><span class="pi">]</span>    <span class="c1"># useful in performing queries to filter </span>
                          <span class="c1"># logs and create visualizations</span>

<span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">log</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">paths</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">/other/path/to/data/*.csv</span>
  <span class="na">tags</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">csv-type-y"</span><span class="pi">]</span>

<span class="na">output.logstash</span><span class="pi">:</span>
   <span class="na">hosts</span><span class="pi">:</span> <span class="pi">[</span> <span class="s2">"</span><span class="s">&lt;logstash_host&gt;:5044"</span><span class="pi">]</span>
</code></pre></div></div> <p><strong>Complete Config</strong></p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">filebeat.inputs</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">log</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">paths</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">/path/to/logs/*.log</span>
  <span class="na">ignore_older</span><span class="pi">:</span> <span class="s">17h</span>
  <span class="na">fields</span><span class="pi">:</span>
    <span class="na">source</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Sample</span><span class="nv"> </span><span class="s">Name</span><span class="nv"> </span><span class="s">1'</span> <span class="c1"># useful while setting multiple pipelines</span>
    <span class="na">tags</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">tag1"</span><span class="pi">]</span>
<span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">log</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">paths</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">/path/to/logs/*.log</span>
  <span class="na">ignore_older</span><span class="pi">:</span> <span class="s">17h</span>
  <span class="na">fields</span><span class="pi">:</span>
    <span class="na">source</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Sample</span><span class="nv"> </span><span class="s">Name</span><span class="nv"> </span><span class="s">2'</span>
    <span class="na">tags</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">tag2"</span><span class="pi">]</span>  
<span class="na">filebeat.config.modules</span><span class="pi">:</span>
  <span class="na">path</span><span class="pi">:</span> <span class="s">${path.config}/modules.d/*.yml</span>
  <span class="na">reload.enabled</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">setup.ilm.enabled</span><span class="pi">:</span> <span class="s">auto</span>
<span class="na">setup.ilm.policy_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">sample-policy"</span>
<span class="na">setup.ilm.overwrite</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">setup.ilm.rollover_alias</span><span class="pi">:</span> <span class="s1">'</span><span class="s">sample-alias-7.8.1'</span>
<span class="na">setup.template.settings</span><span class="pi">:</span>
  <span class="na">index.number_of_shards</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">setup.template.enabled</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">setup.template.overwrite</span><span class="pi">:</span> <span class="kc">false</span>
  <span class="na">setup.template.name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">sample-template"</span>
  <span class="na">setup.template.pattern</span><span class="pi">:</span> <span class="s2">"</span><span class="s">sample-template-7.8.1-*"</span>
<span class="na">setup.kibana</span><span class="pi">:</span>
  <span class="na">host</span><span class="pi">:</span> <span class="s2">"</span><span class="s">kibana_host:5601"</span>
<span class="na">output.logstash</span><span class="pi">:</span>
   <span class="na">hosts</span><span class="pi">:</span> <span class="pi">[</span> <span class="s2">"</span><span class="s">logstash_host:5044"</span><span class="pi">]</span>

</code></pre></div></div> <p>Detailed info on configurations <a href="https://www.elastic.co/guide/en/beats/filebeat/current/configuring-howto-filebeat.html" target="_blank" rel="noopener noreferrer">here</a>. Find more configs <a href="https://www.elastic.co/guide/en/beats/filebeat/current/configuration-filebeat-options.html" target="_blank" rel="noopener noreferrer">here</a>.</p> <p><strong>NOTE</strong> Disable the defaults in <code class="language-plaintext highlighter-rouge">modules.d/system.yml</code> to avoid system logs.</p> <h3 id="4-set-up-assets">4. Set up assets</h3> <p>From <code class="language-plaintext highlighter-rouge">/etc/filebeat</code> run</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>filebeat setup <span class="nt">-e</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">-e</code> is optional and it redirects the error messages from log files to console.</p> <p><strong>NOTE</strong> : In case you get errors static elasticsearch is not configured, it’s a known <a href="https://github.com/elastic/beats/issues/16336" target="_blank" rel="noopener noreferrer">issue</a> on github. Use</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>filebeat <span class="nt">-e</span>
</code></pre></div></div> <p>Create a systemd service for filebeat at <code class="language-plaintext highlighter-rouge">/etc/systemd/system/filebeat.service</code> with the config</p> <pre><code class="language-service"> [Unit]
 Description=Pystrat Filebeat Service
 After=network.target
 StartLimitIntervalSec=0
 [Service]
 Type=simple
 Restart=always
 RestartSec=5s
 User=deepak
 ExecStart=/usr/bin/filebeat -e
 
 [Install]
 WantedBy=multi-user.target
</code></pre> <h3 id="5-start-filebeat">5. Start filebeat</h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># If you haven't set up filebeat as a systemd process, </span>
<span class="c"># it has been explained later</span>
<span class="nb">sudo </span>service filebeat start 
</code></pre></div></div> <p>OR</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>filebeat <span class="nt">-e</span> <span class="nt">-c</span> filebeat.yml <span class="nt">-d</span> <span class="s2">"publish"</span>
</code></pre></div></div> <h3 id="6-set-up-appropriate-pipeline-configurations">6. Set up appropriate pipeline configurations</h3> <p>Further explanation on pipeline configurations in Logstash section.</p> <h3 id="7-view-data-in-kibana">7. View data in Kibana</h3> <p>Open Kibana dashboard(<code class="language-plaintext highlighter-rouge">http://kibana_host:5601</code>).</p> <h3 id="8-filebeat-log-location">8. Filebeat Log location</h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/var/log/filebeat/
</code></pre></div></div> <p><a href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-installation-configuration.html" target="_blank" rel="noopener noreferrer">Source</a></p> <p>Follow up with the <a href="https://www.deepakgouda.com/Logstash" target="_blank" rel="noopener noreferrer">Logstash</a> article next.</p> </article> </div> </div> <footer class="sticky-bottom mt-5"> <div class="container" style="text-align:center;"> © Copyright 2025 Deepak Gouda. <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer"> Template here!</a>. All images are my own. Last updated: February 06, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha256-l/1pMF/+J4TThfgARS6KwWrk/egwuVvhRzfLAMQ6Ds4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha256-SyTu6CwrfOhaznYZPoolVw2rxoY7lKYKQvqbtqN93HI=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script src="/assets/js/zoom.js"></script> <script src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>