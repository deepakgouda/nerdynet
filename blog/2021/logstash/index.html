<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Logstash | Deepak Gouda</title> <meta name="author" content="Deepak Gouda"/> <meta name="description" content="Setting up Logstash module of ELK stack [Part 3]."/> <meta name="keywords" content="academic-website, portfolio-website"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="/assets/img/title-icon.png"/> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://deepakgouda.github.io/blog/2021/logstash/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="https://deepakgouda.github.io/"><span class="font-weight-bold">Deepak</span> Gouda</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/shots/">shots</a> </li> <li class="nav-item "> <a class="nav-link" href="/gallery/">gallery</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/talks/">talks</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/genealogy/">genealogy</a> <a class="dropdown-item" href="/checklist/">checklist</a> </div> </li> <div class="toggle-container"> <a id="light-toggle"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </a> </div> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Logstash</h1> <p class="post-meta">February 25, 2021</p> <p class="post-tags"> <a href="/blog/2021"> <i class="fas fa-calendar fa-sm"></i> 2021 </a>   ·   <a href="/blog/tag/tech"> <i class="fas fa-hashtag fa-sm"></i> tech</a>   <a href="/blog/tag/framework"> <i class="fas fa-hashtag fa-sm"></i> framework</a>   <a href="/blog/tag/setup"> <i class="fas fa-hashtag fa-sm"></i> setup</a>     ·   <a href="/blog/category/Setup"> <i class="fas fa-tag fa-sm"></i> Setup</a>   </p> </header> <article class="post-content"> <p>This article is the third module of the <strong>Self-managed ELK Stack</strong> article behind <a href="https://www.deepakgouda.com/Self-managed-ELK-Stack" target="_blank" rel="noopener noreferrer">Introduction</a> and <a href="https://www.deepakgouda.com/Filebeat" target="_blank" rel="noopener noreferrer">Filebeat</a>. Hence, it is recommended to go through the aforementioned articles before proceeding with Logstash.</p> <h3 id="installation">Installation</h3> <p><a href="https://www.elastic.co/guide/en/logstash/current/installing-logstash.html" target="_blank" rel="noopener noreferrer">Instructions here</a></p> <h3 id="configuration">Configuration</h3> <p>Workflow : We have installed filebeat on multiple machines which produce various types of logs. For instance let us consider the situation where machine M1 and M2 each run processes P1 and P2, hence producing logs of category C1 and C2 each. Segregating logs at filebeat is difficult but we can add tags to differentiate the logs in logstash. We setup two separate pipilines such that, logs of type C1 and C2 are parsed separately with a modular config file for each of them.</p> <ol> <li>Assign a source name for each filebeat in <em>filebeat.yml</em>. This source name will be used to segregate logs and redirect them to different pipelines.</li> </ol> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="na">filebeat.inputs</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">log</span>
      <span class="na">fields</span><span class="pi">:</span>
        <span class="na">source</span><span class="pi">:</span> <span class="s1">'</span><span class="s">samplename'</span>
      <span class="na">fields_under_root</span><span class="pi">:</span> <span class="kc">true</span>
</code></pre></div></div> <ol> <li>Create <em>pipeline.yml</em> in <code class="language-plaintext highlighter-rouge">/etc/logstash/</code> with the following configuration</li> </ol> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="pi">-</span> <span class="na">pipeline.id</span><span class="pi">:</span> <span class="s">beats-server</span>
      <span class="na">config.string</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">input { beats { port =&gt; 5044 } }</span>
        <span class="s">output</span>
  <span class="pi">{</span>
            <span class="nv">if</span> <span class="pi">[</span><span class="nv">source</span><span class="pi">]</span> <span class="nv">== 'dbservername'</span>
   <span class="pi">{</span>
              <span class="nv">pipeline</span> <span class="pi">{</span> <span class="nv">send_to =&gt; dblog</span> <span class="pi">}</span>
            <span class="pi">}</span>
   <span class="nv">else if</span> <span class="pi">[</span><span class="nv">source</span><span class="pi">]</span> <span class="nv">== 'apiservername'</span>
   <span class="pi">{</span>
              <span class="nv">pipeline</span> <span class="pi">{</span> <span class="nv">send_to =&gt; apilog</span> <span class="pi">}</span>
            <span class="pi">}</span>
   <span class="nv">else if</span> <span class="pi">[</span><span class="nv">source</span><span class="pi">]</span> <span class="nv">== 'webservername'</span>
   <span class="pi">{</span> 
              <span class="nv">pipeline</span> <span class="pi">{</span> <span class="nv">send_to =&gt; weblog</span> <span class="pi">}</span> 
            <span class="pi">}</span>
        <span class="pi">}</span>

    <span class="pi">-</span> <span class="na">pipeline.id</span><span class="pi">:</span> <span class="s">dblog</span>
      <span class="na">path.config</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/Logstash/config/pipelines/dblogpipeline.conf"</span>

    <span class="pi">-</span> <span class="na">pipeline.id</span><span class="pi">:</span> <span class="s">apilog</span> 
      <span class="na">path.config</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/Logstash/config/pipelines/apilogpipeline.conf"</span>

    <span class="pi">-</span> <span class="na">pipeline.id</span><span class="pi">:</span> <span class="s">weblog</span>
      <span class="na">path.config</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/Logstash/config/pipelines/weblogpipeline.conf"</span>
</code></pre></div></div> <ol> <li> <p>Create separate Logstash configuration files for each pipeline at: <code class="language-plaintext highlighter-rouge">/etc/logstash/conf.d/&lt;conf_name&gt;.conf</code>. According to this pipeline config, the three config files should be <code class="language-plaintext highlighter-rouge">dblogpipeline.conf</code>, <code class="language-plaintext highlighter-rouge">apilogpipeline.conf</code> and <code class="language-plaintext highlighter-rouge">weblogpipeline.conf</code>.</p> </li> <li> <p>Create the individual logstash configurations using the following template. The grok parse instances have been mentioned in a separate article later.</p> </li> </ol> <p><strong><em>config.conf</em></strong></p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">input</span><span class="w">
</span><span class="p">{</span><span class="w">
 </span><span class="err">pipeline</span><span class="w">
 </span><span class="p">{</span><span class="w">
  </span><span class="err">address</span><span class="w"> </span><span class="err">=&gt;</span><span class="w"> </span><span class="err">sample_filebeat</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="err">filter</span><span class="w">
</span><span class="p">{</span><span class="w">
 </span><span class="err">grok</span><span class="w">
 </span><span class="p">{</span><span class="w">
  </span><span class="err">match</span><span class="w"> </span><span class="err">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"message"</span><span class="w"> </span><span class="err">=&gt;</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"%{TIMESTAMP_ISO8601:log_ts}</span><span class="se">\+</span><span class="s2">05</span><span class="se">\:</span><span class="s2">30  </span><span class="se">\[</span><span class="s2">%{DATA:log_class}</span><span class="se">\]</span><span class="s2">  </span><span class="se">\"</span><span class="s2">%{DATA:error_msg} for class </span><span class="se">\:</span><span class="s2"> %{DATA:class_name}</span><span class="se">\"</span><span class="s2">"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"%{TIMESTAMP_ISO8601:log_ts}</span><span class="se">\+</span><span class="s2">05</span><span class="se">\:</span><span class="s2">30  </span><span class="se">\[</span><span class="s2">%{DATA:log_class}</span><span class="se">\]</span><span class="s2">  </span><span class="se">\"</span><span class="s2">response received at </span><span class="se">\:</span><span class="s2">%{TIMESTAMP_ISO8601:response_ts} for class </span><span class="se">\:</span><span class="s2"> %{DATA:segment}</span><span class="se">\"</span><span class="s2">"</span><span class="w">
      </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
 </span><span class="p">}</span><span class="w">

 </span><span class="err">date</span><span class="w">
 </span><span class="p">{</span><span class="w">
  </span><span class="err">match</span><span class="w"> </span><span class="err">=&gt;</span><span class="w"> </span><span class="p">[</span><span class="s2">"log_ts"</span><span class="p">,</span><span class="w"> </span><span class="s2">"YYYY-MM-dd HH:mm:ss.SSS"</span><span class="p">]</span><span class="w">
  </span><span class="err">target</span><span class="w"> </span><span class="err">=&gt;</span><span class="w"> </span><span class="s2">"@timestamp"</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="err">output</span><span class="w">
</span><span class="p">{</span><span class="w">
 </span><span class="err">elasticsearch</span><span class="w">
 </span><span class="p">{</span><span class="w">
  </span><span class="err">index</span><span class="w"> </span><span class="err">=&gt;</span><span class="w"> </span><span class="s2">"sample_index"</span><span class="w">
  </span><span class="err">hosts</span><span class="w"> </span><span class="err">=&gt;</span><span class="w"> </span><span class="p">[</span><span class="s2">"localhost:9200"</span><span class="p">]</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <ol> <li>Create a systemd service and start Logstash with <code class="language-plaintext highlighter-rouge">sudo service logstash start</code> </li> <li>In Kibana, go to Management → Kibana Index Patterns. Kibana will display the Logstash index along with the parsed logs.</li> </ol> <h3 id="grok-patterns">Grok Patterns</h3> <p>Non-intuitive and custom grok pattern as well as examples have been mentioned in a <a href="https://www.deepakgouda.com/GrokPatterns.md" target="_blank" rel="noopener noreferrer">separate post</a></p> <h3 id="source">Source</h3> <p>I would like mention <a href="https://www.codeproject.com/Tips/5271551/Configure-Multiple-Pipeline-in-Logstash" target="_blank" rel="noopener noreferrer">this article</a> from Code Project which helped me understand the required configurations needed to set multiple pipelines and have put forth the same concisely.</p> <p>Follow up with the <a href="https://www.deepakgouda.com/Kibana" target="_blank" rel="noopener noreferrer">Kibana</a> article next and <a href="https://www.deepakgouda.com/Grok-Patterns" target="_blank" rel="noopener noreferrer">Grok Patterns</a> article optionally.</p> </article> </div> </div> <footer class="sticky-bottom mt-5"> <div class="container" style="text-align:center;"> © Copyright 2025 Deepak Gouda. <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer"> Template here!</a>. All images are my own. Last updated: February 06, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha256-l/1pMF/+J4TThfgARS6KwWrk/egwuVvhRzfLAMQ6Ds4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha256-SyTu6CwrfOhaznYZPoolVw2rxoY7lKYKQvqbtqN93HI=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script src="/assets/js/zoom.js"></script> <script src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>