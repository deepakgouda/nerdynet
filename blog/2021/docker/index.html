<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>It's time for Docker | Deepak Gouda</title> <meta name="author" content="Deepak Gouda"/> <meta name="description" content="My notes on creating a docker image, spinning up containers and using docker volumes."/> <meta name="keywords" content="academic-website, portfolio-website"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="/assets/img/title-icon.png"/> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://deepakgouda.github.io/blog/2021/docker/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="https://deepakgouda.github.io/"><span class="font-weight-bold">Deepak</span> Gouda</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/shots/">shots</a> </li> <li class="nav-item "> <a class="nav-link" href="/gallery/">gallery</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/talks/">talks</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/genealogy/">genealogy</a> <a class="dropdown-item" href="/checklist/">checklist</a> </div> </li> <div class="toggle-container"> <a id="light-toggle"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </a> </div> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">It's time for Docker</h1> <p class="post-meta">June 4, 2021</p> <p class="post-tags"> <a href="/blog/2021"> <i class="fas fa-calendar fa-sm"></i> 2021 </a>   ·   <a href="/blog/tag/tech"> <i class="fas fa-hashtag fa-sm"></i> tech</a>   <a href="/blog/tag/framework"> <i class="fas fa-hashtag fa-sm"></i> framework</a>   <a href="/blog/tag/setup"> <i class="fas fa-hashtag fa-sm"></i> setup</a>     ·   <a href="/blog/category/Setup"> <i class="fas fa-tag fa-sm"></i> Setup</a>   </p> </header> <article class="post-content"> <h2 id="why-docker">Why Docker?</h2> <p>Recently we started working on a big project with two separate codebases and several modules with disparate dependencies. Each dependency had a separate installation procedure and replicating the setup in a new machine started getting cumbersome. Quite often either the installations failed, build failed or the CI/CD broke off. Hence, we moved the application into a docker image.</p> <p>A docker image is a standardized executable component that combines application source code with all the operating system (OS) libraries and dependencies required to run the code in any environment. Creating a docker image requires a one-time setup in a <code class="language-plaintext highlighter-rouge">Dockerfile</code>. Several frameworks, for instance database systems like Postgres can be installed as a docker image. One can pull the docker image and get the DB up and running in seconds, hence circumventing the entire installation procedure. Just like spawning virual machines, one can spin up several docker containers and each will be in an isolated environment hence precluding dependency errors, version issues and helping in error replications.</p> <h2 id="how-to-setup-a-docker-image">How to setup a Docker image?</h2> <p>Let us consider a sample C++ project <strong>Titan</strong> which uses <em>cmake</em> to build and further, interacts with a PostgreSQL database. We will be using the C++ client <code class="language-plaintext highlighter-rouge">libpqxx</code> to interact with the database. Hence, the <code class="language-plaintext highlighter-rouge">DockerFile</code> would install all the necessary frameworks just like setting up a fresh machine. We would be using an Ubuntu 20.04 environment for the same and the <code class="language-plaintext highlighter-rouge">DockerFile</code> would look like :</p> <h3 id="sample-code-and-configurations">Sample code and configurations</h3> <h4 id="docker">Docker</h4> <div class="language-docker highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Specify OS</span>
<span class="k">FROM</span><span class="s"> ubuntu:20.04</span>

<span class="c"># Specify work directory</span>
<span class="k">COPY</span><span class="s"> . /usr/src/Titan</span>

<span class="c"># Perform necessary installations</span>
<span class="k">RUN </span>apt-get update <span class="o">&amp;&amp;</span> apt-get <span class="nt">-y</span> <span class="nb">install </span>cmake git vim gdb gcc-9 g++-9 build-essential

<span class="c"># Install libpqxx</span>
<span class="k">RUN </span>apt <span class="nb">install</span> <span class="nt">-y</span> libpq-dev
<span class="k">WORKDIR</span><span class="s"> /usr/src/Downloads/</span>
<span class="k">RUN </span><span class="nb">mkdir</span> <span class="nt">-p</span> /usr/src/Downloads/
<span class="k">RUN </span>git clone https://github.com/jtv/libpqxx.git
<span class="k">WORKDIR</span><span class="s"> /usr/src/Downloads/libpqxx</span>
<span class="k">RUN </span>./configure
<span class="k">RUN </span>make
<span class="k">RUN </span>make <span class="nb">install</span>

<span class="c"># Build the source</span>
<span class="k">RUN </span><span class="nb">mkdir</span> <span class="nt">-p</span> /usr/src/Titan/build
<span class="k">WORKDIR</span><span class="s"> /usr/src/Titan/build</span>
<span class="k">RUN </span>cmake ..
<span class="k">RUN </span>make
</code></pre></div></div> <h4 id="cmake">CMake</h4> <div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cmake_minimum_required</span><span class="p">(</span>VERSION 3.0.0<span class="p">)</span>
<span class="nb">project</span><span class="p">(</span>Titan VERSION 0.1.0<span class="p">)</span>

<span class="c1"># flags</span>
<span class="nb">set</span><span class="p">(</span>CMAKE_CXX_STANDARD 20<span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>CMAKE_CXX_STANDARD_REQUIRED True<span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>CMAKE_CXX_FLAGS <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CXX_FLAGS</span><span class="si">}</span><span class="s2"> -Wall"</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>CMAKE_CXX_FLAGS <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CXX_FLAGS</span><span class="si">}</span><span class="s2"> -pthread"</span><span class="p">)</span>

<span class="c1"># include source files and header</span>
<span class="nb">include_directories</span><span class="p">(</span><span class="si">${</span><span class="nv">CMAKE_SOURCE_DIR</span><span class="si">}</span>/src <span class="si">${</span><span class="nv">CMAKE_SOURCE_DIR</span><span class="si">}</span>/include<span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>SOURCES ./src/main.cpp ./src/utility.cpp<span class="p">)</span>
<span class="nb">add_executable</span><span class="p">(</span>main <span class="si">${</span><span class="nv">SOURCES</span><span class="si">}</span><span class="p">)</span>

<span class="c1"># include `libpq` and `libpqxx`</span>
<span class="nb">find_library</span><span class="p">(</span>PQXX_LIB pqxx<span class="p">)</span>
<span class="nb">find_library</span><span class="p">(</span>PQ_LIB pq<span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span>main <span class="si">${</span><span class="nv">PQXX_LIB</span><span class="si">}</span> <span class="si">${</span><span class="nv">PQ_LIB</span><span class="si">}</span><span class="p">)</span>
</code></pre></div></div> <p>Here, we use C++ 20 and compile the source files <code class="language-plaintext highlighter-rouge">main.cpp</code> and <code class="language-plaintext highlighter-rouge">utility.cpp</code> into the binary <code class="language-plaintext highlighter-rouge">main</code>. We also link <code class="language-plaintext highlighter-rouge">libpqxx</code> and <code class="language-plaintext highlighter-rouge">libpq</code> to the binary.</p> <h3 id="building-and-running-the-container">Building and running the container</h3> <p><em>Note : If you get permission issue, add your user to a <code class="language-plaintext highlighter-rouge">usergroup</code> and allow the group the permission to execute <code class="language-plaintext highlighter-rouge">/var/run/docker.sock</code></em></p> <p>We build the docker container using</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">--pull</span> <span class="nt">--rm</span> <span class="nt">-f</span> <span class="s2">"/path/to/Dockerfile"</span> <span class="nt">-t</span> titan:madman <span class="s2">"/path/to/Titan"</span> 
</code></pre></div></div> <p>This creates a docker image which performas all the installations and builds necessary. Now one can spawn several instances of this environment instantaneously.</p> <p>Additional <code class="language-plaintext highlighter-rouge">docker image</code> commands:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker images                   <span class="c"># view all docker images using</span>
docker image <span class="nb">rm</span> &lt;image_name&gt;    <span class="c"># remove a docker image</span>
</code></pre></div></div> <p><em>Note : All Docker files are physically located in /var/lib/docker/</em></p> <p>Running to run a container using the docker image</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--rm</span> <span class="nt">-it</span> titan:madman                                            <span class="c"># spawn an interactive terminal along with the container</span>
docker run <span class="nt">--rm</span> <span class="nt">-it</span> <span class="nt">--network</span><span class="o">=</span>host titan:madman                             <span class="c"># connect container to network</span>
docker run <span class="nt">--name</span> sanguine_strange <span class="nt">--rm</span> <span class="nt">-it</span> <span class="nt">--network</span><span class="o">=</span>host titan:madman     <span class="c"># give a custom name to the container</span>
</code></pre></div></div> <p>Additional <code class="language-plaintext highlighter-rouge">docker container</code> commands</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker container <span class="nb">ls</span>                         <span class="c"># list all containers</span>
docker container stop &lt;container-id/name&gt;   <span class="c"># stop a container</span>
docker container <span class="nb">rm</span> &lt;container-id/name&gt;     <span class="c"># remove a container</span>
</code></pre></div></div> <h3 id="persistent-storage">Persistent storage</h3> <p>Individual docker containers do not have a persistent storage, making them lightweight and fast. To persist storage, one can use <code class="language-plaintext highlighter-rouge">docker volume</code>. Effectively, docker volumes are similar to <a href="https://docs.docker.com/storage/bind-mounts/" target="_blank" rel="noopener noreferrer">bind mounts</a> except that volumes are managed by Docker and are isolated from the core functionality of the host machine. We map a specific directory on disk to a mount volume inside the docker.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker volume create data_lake
docker run <span class="nt">--network</span><span class="o">=</span>host <span class="nt">--rm</span> <span class="nt">-it</span> <span class="nt">-v</span> data_lake:/mnt/data titan:madman      <span class="c"># the volume will be mounted to /mnt/data inside the container</span>
</code></pre></div></div> <p><em>Note : the volume can be found at /var/lib/docker/volume/&lt;volume_name&gt;/_data</em></p> <p>A single docker volume can be mounted to multiple containers and hence can be used as data mounts or for interprocess communication as well.</p> <h3 id="setting-up-postgres">Setting up Postgres</h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># download the postgres latest image</span>
docker pull postgres

<span class="c"># spawn a container</span>
docker run <span class="nt">--name</span> bigger_banner <span class="nt">-e</span> <span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span>postgres <span class="nt">-it</span> <span class="nt">-p</span> 5432:5432 <span class="nt">-v</span> data_lake:/var/lib/postgresql/data/ postgres:latest
</code></pre></div></div> <p>Here, we map the volume <code class="language-plaintext highlighter-rouge">data_lake</code> to the postgres default installation directory. Now, we can spin a separate container with the volume <code class="language-plaintext highlighter-rouge">data_lake</code> mapped to <code class="language-plaintext highlighter-rouge">/var/lib/postgresql/data/</code> and now the new container can access postgres although they are two separate instances.</p> <h3 id="setting-up-vscode-environment">Setting up VSCode environment</h3> <p>Useful extensions :</p> <ul> <li>Docker - orchestrates the docker containers</li> <li>devcontainers.io : to open the container in VSCode</li> </ul> </article> </div> </div> <footer class="sticky-bottom mt-5"> <div class="container" style="text-align:center;"> © Copyright 2025 Deepak Gouda. <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer"> Template here!</a>. All images are my own. Last updated: February 06, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha256-l/1pMF/+J4TThfgARS6KwWrk/egwuVvhRzfLAMQ6Ds4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha256-SyTu6CwrfOhaznYZPoolVw2rxoY7lKYKQvqbtqN93HI=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script src="/assets/js/zoom.js"></script> <script src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>