<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>FRRouters - Configuring Intra/Inter-domain Routing | Deepak Gouda</title> <meta name="author" content="Deepak Gouda"/> <meta name="description" content="Configuring OSPF, BGP on FRRouters"/> <meta name="keywords" content="academic-website, portfolio-website"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="/assets/img/title-icon.png"/> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://deepakgouda.github.io/blog/2022/frr/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="https://deepakgouda.github.io/"><span class="font-weight-bold">Deepak</span> Gouda</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/shots/">shots</a> </li> <li class="nav-item "> <a class="nav-link" href="/gallery/">gallery</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/talks/">talks</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/genealogy/">genealogy</a> <a class="dropdown-item" href="/checklist/">checklist</a> </div> </li> <div class="toggle-container"> <a id="light-toggle"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </a> </div> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">FRRouters - Configuring Intra/Inter-domain Routing</h1> <p class="post-meta">December 21, 2022</p> <p class="post-tags"> <a href="/blog/2022"> <i class="fas fa-calendar fa-sm"></i> 2022 </a>   ·   <a href="/blog/tag/tech"> <i class="fas fa-hashtag fa-sm"></i> tech</a>     ·   <a href="/blog/category/Setup"> <i class="fas fa-tag fa-sm"></i> Setup</a>   </p> </header> <article class="post-content"> <h2 id="config-commands">Config commands</h2> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~ ip address show

~ ip route list
default via 65.200.0.1 dev ssh
65.200.0.0/24 dev ssh scope <span class="nb">link  </span>src 65.200.0.1
65.200.0.0/24 dev 65-S1 scope <span class="nb">link  </span>src 65.200.0.3
158.65.0.0/16 dev ssh scope <span class="nb">link  </span>src 158.65.10.6

~ ip address add 65.200.0.1/24 dev 65-S1
~ ip address del 65.200.0.1/24 dev 65-S1
~ ip route add default/24 via 65.200.0.1 dev 65-S1 <span class="c"># add default gateway</span>
~ ip route del default/24 via 65.200.0.1 dev 65-S1 <span class="c"># delete default gateway</span>
~ netstat <span class="nt">-t</span> <span class="c"># current default gateway</span>
~ route <span class="nt">-n</span> <span class="c"># old school command</span>
</code></pre></div></div> <h4 id="note-">Note :</h4> <blockquote> <p>Commands are identical for IPv6 <br> IPv6 routes : <code class="language-plaintext highlighter-rouge">ip -6 route</code> <br> For IPv6, do not delete or change the link local address (the one starting with <code class="language-plaintext highlighter-rouge">fe80</code>). <br></p> </blockquote> <h1 id="network-topology">Network Topology</h1> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source media="(max-width: 480px)" srcset="/assets/img/frr/609-480.webp"></source> <source media="(max-width: 800px)" srcset="/assets/img/frr/609-800.webp"></source> <source media="(max-width: 1400px)" srcset="/assets/img/frr/609-1400.webp"></source> <img class="img-fluid rounded z-depth-1" src="/assets/img/frr/609.png" data-zoomable=""> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source media="(max-width: 480px)" srcset="/assets/img/frr/145-480.webp"></source> <source media="(max-width: 800px)" srcset="/assets/img/frr/145-800.webp"></source> <source media="(max-width: 1400px)" srcset="/assets/img/frr/145-1400.webp"></source> <img class="img-fluid rounded z-depth-1" src="/assets/img/frr/145.png" data-zoomable=""> </picture> </figure> </div> <h3 id="notes">Notes</h3> <ul> <li>One host is connected to each router (not shown in the figure for clarity).</li> <li>Every router, but the ones at <code class="language-plaintext highlighter-rouge">GENE</code> and <code class="language-plaintext highlighter-rouge">ZURI</code>, has an external connection to one of your neighboring ASes.</li> </ul> <h1 id="frrouting">FRRouting</h1> <h4 id="autocompletion-features">Autocompletion features</h4> <p>When you enter the FRR CLI, you see the following line:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>router#
</code></pre></div></div> <p>At any time in the CLI, you can type <code class="language-plaintext highlighter-rouge">?</code> to see all the possible commands you can currently type (some of the shown commands are):</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>router# ?
    clear       Reset functions
    configure   Configuration from vty interface
    exit        Exit current mode and down to previous mode
    no          Negate a command or set its defaults
    ping        Send echo messages
    quit        Exit current mode and down to previous mode
    show        Show running system information
    traceroute  Trace route to destination
    write       Write running configuration to memory, network, or terminal
</code></pre></div></div> <p>For example, the command <code class="language-plaintext highlighter-rouge">show</code> will print various snapshots of the router state. To see what kind of information can be shown, just type <code class="language-plaintext highlighter-rouge">show ?</code>. For example, <code class="language-plaintext highlighter-rouge">show running-config</code> will print the running configuration.</p> <blockquote> <p>The interfaces are not visible in the output at the beginning, but will start appearing as soon as you have configured them.</p> </blockquote> <p>You can shorten the commands when there is no possible ambiguity. For instance <code class="language-plaintext highlighter-rouge">show run</code> is equivalent to <code class="language-plaintext highlighter-rouge">show running-config</code>. Similarly to the Linux terminal, you can also use auto-completion by pressing the tabulator key.</p> <h4 id="testing-connectivity">Testing connectivity</h4> <p>If you want to test your connectivity, you can use <code class="language-plaintext highlighter-rouge">ping</code> or <code class="language-plaintext highlighter-rouge">traceroute</code> from the CLI of the routers. However, whenever it is possible, always prefer to run the <code class="language-plaintext highlighter-rouge">ping</code> and <code class="language-plaintext highlighter-rouge">traceroute</code> from the hosts because they can use DNS whereas the routers cannot.</p> <h4 id="switching-to-configuration-mode">Switching to configuration mode</h4> <p>To configure your router, you must enter the configuration mode with <code class="language-plaintext highlighter-rouge">configure terminal</code> (<code class="language-plaintext highlighter-rouge">conf t</code> for the short version). You can verify that you are in the configuration mode by looking for the <em>config</em> prefix in your CLI prompt. Use <code class="language-plaintext highlighter-rouge">exit</code> to leave the configuration mode and to go back to the previous mode. Commands that work <em>in</em> configuration mode do not (necessarily) work <em>outside</em> configuration mode and vice versa. Notably, commands starting with <code class="language-plaintext highlighter-rouge">show</code> do not work in configuration mode.</p> <h4 id="undo-a-command">Undo a command</h4> <p>If you want to delete parts of the configuration, you can prefix the command you want to remove with <code class="language-plaintext highlighter-rouge">no</code>. For example, if you add an IP address to an interface with the command</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ip address 1.0.0.1/24
</code></pre></div></div> <p>(explained in more detail in the next section of the tutorial), you can simply run</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>no ip address 1.0.0.1/24
</code></pre></div></div> <p>to remove the IP address again.</p> <h4 id="note">Note</h4> <blockquote> <p>The interfaces are not visible in the output at the beginning, but will start appearing as soon as you have configured them. <br> To test connectivity you can use <code class="language-plaintext highlighter-rouge">ping</code> or <code class="language-plaintext highlighter-rouge">traceroute</code> from the CLI of the routers <br> To configure your router, you must enter the configuration mode with <code class="language-plaintext highlighter-rouge">configure terminal</code> <br></p> </blockquote> <h3 id="interface-configs">Interface configs</h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>show interface &lt;interface name&gt;

router# conf t
router(config)# interface INTERFACENAME
router(config-if)# ip address 1.0.0.1/24
</code></pre></div></div> <h3 id="configure-static-routes">Configure static routes</h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>router# conf t
router(config)# ip route 3.0.0.0/24 2.0.0.2
router(config)# ip route 4.0.0.0/24 someinterface
router# show ip route static
S   3.0.0.0/24 [1/0] via 2.0.0.2 inactive
</code></pre></div></div> <h3 id="verification">Verification</h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>show run <span class="c"># verify if the config has been updated correctly</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>router# show ip route connected
C&gt;* 2.0.0.0/24 is directly connected, INTERFACENAME
</code></pre></div></div> <h4 id="note-1">Note</h4> <blockquote> <p>Do <strong>not</strong> configure two different IP addresses on one interface at the same time. If you have configured a wrong IP address, first remove the address with the <code class="language-plaintext highlighter-rouge">no</code> command and then configure a new IP address:</p> </blockquote> <h1 id="ospf">OSPF</h1> <p>OSPF routers flood IP routes over OSPF adjacencies. FRR routers continuously (and automatically) probe any OSPF-enabled interface to discover new neighbors to establish adjacencies with. By default, FRR router will activate OSPF on any interface whose prefix is covered by a <code class="language-plaintext highlighter-rouge">network</code> command under the <code class="language-plaintext highlighter-rouge">router ospf</code> part of the configuration. For instance, the following configuration would activate OSPF on any interface whose IP address falls under <code class="language-plaintext highlighter-rouge">1.0.0.0/24</code> or <code class="language-plaintext highlighter-rouge">2.0.0.0/24</code>:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>router# conf t
router(config)# router ospf
router(config)# network 1.0.0.0/24 area 0
router(config)# network 2.0.0.0/24 area 0
</code></pre></div></div> <p>OSPF has scalability issues when there is a large number of routers. To make it more scalable, the router topology can be hierarchically divided in what is called “areas”. In this assignment, your network is small and you do not need more than one area: you will only use area 0.</p> <p>To check the OSPF neighbors of a router, you can use the following command:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>router# show ip ospf neighbor
    Neighbor    ID  Pri State Dead Time   Address Interface   RXmtL   RqstL   DBsmL
    1.0.0.2 1   Full/Backup     1.0.0.2 port_BASE:1.0.0.1   0   0   0
    2.0.0.2 1   Full/Backup     2.0.0.2 port_LUGA:2.0.0.1   0   0   0
</code></pre></div></div> <blockquote> <p>The <code class="language-plaintext highlighter-rouge">Neighbor</code> may be a different IP than you expect since it is an ID that may come from any interface, e.g. also the <code class="language-plaintext highlighter-rouge">ssh</code> interface. Do not worry about this.</p> </blockquote> <p>Here, we see that the router has established two OSPF sessions with two neighbors. The first one is connected via the interface <code class="language-plaintext highlighter-rouge">1.0.0.1</code> and its IP is <code class="language-plaintext highlighter-rouge">1.0.0.2</code>. The second one is connected via the interface <code class="language-plaintext highlighter-rouge">2.0.0.1</code> and its IP is <code class="language-plaintext highlighter-rouge">2.0.0.2</code>. Now that you are connected to two routers with OSPF, they can send you information about the topology of the network. Let’s take at look at the routes received by OSPF with the following command.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>router# show ip route ospf
O   1.0.0.0/24 [110/10] is directly connected, port_BASE, 07:09:33
O   2.0.0.0/24 [110/10] is directly connected, port_LUGA, 06:14:24
O&gt;* 10.104.0.0/24 [110/20] via 2.0.0.2, port_LUGA, 00:00:10
</code></pre></div></div> <p>You can see that our router has learned how to reach the subnet <code class="language-plaintext highlighter-rouge">10.104.0.0/24</code>. The <code class="language-plaintext highlighter-rouge">O</code> at the beginning of each line indicates that the router has learned this subnet from OSPF. To reach it, it must send the packets to its neighbor router <code class="language-plaintext highlighter-rouge">2.0.0.2</code>. If you want to have more information about the routers of this OSPF area, you can use <code class="language-plaintext highlighter-rouge">show ip ospf database</code>.</p> <p>With OSPF, each link between two routers has a specific weight, and only the shortest paths are used to forward packets. Below is an example of how you set the weight of a link connected to interface <code class="language-plaintext highlighter-rouge">INTERFACENAME</code> to 900:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>router# conf t
router(config)# interface INTERFACENAME
router(config-if)# ip ospf cost 900
</code></pre></div></div> <p>Use these commands to configure all the OSPF weights in your own network.</p> <h2 id="links">Links</h2> <ul> <li><a href="http://docs.frrouting.org/en/latest/" target="_blank" rel="noopener noreferrer">Official Documentation</a></li> </ul> <h1 id="bgp">BGP</h1> <p>While OSPF is used to provide IP connectivity within an AS, BGP is used to advertise prefixes between different ASes. Unlike OSPF, BGP routers will not automatically establish sessions. Each session needs to be configured individually. The following commands show you how to: start a BGP process and establish two BGP sessions with neighboring routers. The integer following <code class="language-plaintext highlighter-rouge">router bgp</code> indicates your AS-number. Here, the local AS-number is 2:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>router# conf t
router(config)# router bgp 2
router(config-router)# neighbor 150.0.0.1 remote-as 15
router(config-router)# neighbor 2.0.0.2 remote-as 2
</code></pre></div></div> <p>By default, whenever the <code class="language-plaintext highlighter-rouge">remote-as</code> is different from the local number (here 2), the BGP session is configured as an external one (i.e., an eBGP session is established). In contrast, when the <code class="language-plaintext highlighter-rouge">remote-as</code> is equivalent to the local one, the BGP session is configured as an internal one (iBGP). Here, the first session is an eBGP session, established with a router in another AS <code class="language-plaintext highlighter-rouge">150.0.0.1</code>, while the second one is an internal session, established with a router within your AS <code class="language-plaintext highlighter-rouge">2.0.0.2</code>.</p> <p><img class="emoji" title=":exclamation:" alt=":exclamation:" src="https://github.githubassets.com/images/icons/emoji/unicode/2757.png" height="20" width="20"> Important for eBGP sessions with FRR v.7.5 (used in this year’s project): When setting up an eBGP session, there is an implicit route-map which denies everything that is automatically configured on the session. Route-maps enable you to express input and output filters on the routes sent and received by a BGP session. We explain them in detail in the next <a href="2.5.6%20Configure%20BGP%20policies">section</a>. To start advertising and receiving prefixes on an eBGP session, you need to override this implicit route-map by explicitly defining a route-map which permits all (or only some) prefixes, and apply it on the corresponding eBGP session. For instance, to advertise and receive all the prefixes, you need to define a route-map that permits everything:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>router# conf t
router(config)# route-map ACCEPT_ALL permit 10
router(config-route-map)# 
</code></pre></div></div> <p>Then, you need to apply this route-map on the BGP session, for both the advertised and received prefixes:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>router# conf t
router(config)# router bgp 2
router(config-router)# neighbor 150.0.0.1 route-map ACCEPT_ALL in
router(config-router)# neighbor 150.0.0.1 route-map ACCEPT_ALL out
</code></pre></div></div> <p>Now, you should see that our two BGP sessions are up and allow advertising/receiving prefixes. You can check the state of your BGP sessions using the command <code class="language-plaintext highlighter-rouge">show ip bgp summary</code>:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>router# show ip bgp summary
Neighbor        V    AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd
2.0.0.2        4      2       3       6        0    0    0 00:01:16        0
150.0.0.1      4     15    2009    1979        0    0    0 01:31:42        1
</code></pre></div></div> <p>To advertise a prefix on a BGP session, you can just use the following command:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>router# conf t
router(config)# router bgp 2
router(config-router)# network 10.104.0.0/24
</code></pre></div></div> <p>As soon as you do that, your neighbor <code class="language-plaintext highlighter-rouge">150.0.0.1</code> receives this advertisement and knows that it can forward to you all the packets with a destination IP in the subnet <code class="language-plaintext highlighter-rouge">10.104.0.0/24</code>. Note that when you advertise a prefix, it generally means you know how to reach this prefix, otherwise you will drop the packets, and your neighbor will not be very happy.</p> <p><img class="emoji" title=":warning:" alt=":warning:" src="https://github.githubassets.com/images/icons/emoji/unicode/26a0.png" height="20" width="20"> With some routers (and that is the case for our FRR routers) BGP will not announce a route for a prefix that it does not know how to reach. If you want to announce your /8 prefix, you must then configure a default route to <em>Null</em>, such as the following:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ip route 10.104.0.0/24 Null0
</code></pre></div></div> <p>Perhaps one of your BGP neighbor advertises you prefixes as well, let’s check that:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>router# sh ip route bgp
B&gt;* 2.101.0.0/24 [20/0] via 2.0.0.2, interface_used, 00:03:17
</code></pre></div></div> <p>In this case, we can see that neighbor <code class="language-plaintext highlighter-rouge">2.0.0.2</code> has advertised one prefix: <code class="language-plaintext highlighter-rouge">2.101.0.0/24</code>. The <code class="language-plaintext highlighter-rouge">B</code> at the beginning of the line indicates that the router has learned this prefix from BGP.</p> <h3 id="bgp-update-source-for-ibgp-sessions">BGP update-source for iBGP sessions</h3> <p>By default, when a router establishes an iBGP session with a peer, it uses the IP address of the interface closest to the iBGP peer as source address. This is fine as long as this interface is up. If this interface goes down but the actual router is still running, the iBGP connection will tear down even though the router may be reachable over a different path/interface. In practice, operators therefore often use so called “loopback” interfaces as source of the iBGP connections. Loopback interfaces are virtual interfaces with an IP address which uniquely identifies the router in your network. For example, if you are group 7 and you want to configure an iBGP session from <code class="language-plaintext highlighter-rouge">MUNI</code> to <code class="language-plaintext highlighter-rouge">MILA</code>, you could use the following commands (on <code class="language-plaintext highlighter-rouge">MUNI</code>):</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>router# conf t
router(config)# router bgp 7
router(config-router)# neighbor 7.158.0.1 remote-as 7
router(config-router)# neighbor 7.158.0.1 update-source lo
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">7.158.0.1</code> is the loopback interface IP of <code class="language-plaintext highlighter-rouge">MILA</code>. With <code class="language-plaintext highlighter-rouge">update-source lo</code> you make sure that the <code class="language-plaintext highlighter-rouge">MUNI</code> router is using its loopback interface address as source address.</p> <h3 id="bgp-next-hop-self">BGP next-hop-self</h3> <p>The figure below illustrates a possible pitfall when eBGP announcements are distributed over iBGP sessions. If router <code class="language-plaintext highlighter-rouge">R1</code> is advertising its prefix <code class="language-plaintext highlighter-rouge">11.22.33.0/24</code> towards <code class="language-plaintext highlighter-rouge">R2</code> (over the eBGP session), the next-hop of the advertisement is the IP of the outgoing interface of <code class="language-plaintext highlighter-rouge">R1</code> (<code class="language-plaintext highlighter-rouge">10.0.0.2</code>). Router <code class="language-plaintext highlighter-rouge">R2</code> is then distributing this advertisement to all its iBGP neighbors (<code class="language-plaintext highlighter-rouge">R3</code>). Per default, the next-hop of the advertisement is not changed and is still <code class="language-plaintext highlighter-rouge">10.0.0.2</code>. That can lead to problems for router <code class="language-plaintext highlighter-rouge">R3</code>. In a normal network configuration, the subnets used between two eBGP routers (<code class="language-plaintext highlighter-rouge">10.0.0.0/30</code>) are <strong>not</strong> distributed in the connected ASes, e.g. via OSPF. Router <code class="language-plaintext highlighter-rouge">R3</code> does therefore not know how it can reach the next-hop of the advertised prefix (<code class="language-plaintext highlighter-rouge">11.22.33.0/24</code>) and will discard the advertisement. To solve this problem, we can use the BGP <code class="language-plaintext highlighter-rouge">next-hop-self</code> command. When properly configured, router <code class="language-plaintext highlighter-rouge">R2</code> is using its own interface IP as next-hop every time it distributes announcements from eBGP sessions to its iBGP neighbors. In this example, <code class="language-plaintext highlighter-rouge">R2</code> would replace the next-hop <code class="language-plaintext highlighter-rouge">10.0.0.2</code> with its interface IP connected to R3 (<code class="language-plaintext highlighter-rouge">20.0.0.1</code>). Router <code class="language-plaintext highlighter-rouge">R3</code> then receives an advertisement for prefix <code class="language-plaintext highlighter-rouge">11.22.33.0/24</code> with next-hop <code class="language-plaintext highlighter-rouge">20.0.0.1</code>. The <code class="language-plaintext highlighter-rouge">20.0.0.0/30</code> subnet is distributed via OSPF and <code class="language-plaintext highlighter-rouge">R3</code> does therefore know how to reach the next-hop of the advertisement and can install this prefix in its forwarding table.</p> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source media="(max-width: 480px)" srcset="/assets/img/frr/next-hop-self-480.webp"></source> <source media="(max-width: 800px)" srcset="/assets/img/frr/next-hop-self-800.webp"></source> <source media="(max-width: 1400px)" srcset="/assets/img/frr/next-hop-self-1400.webp"></source> <img class="img-fluid rounded z-depth-1" src="/assets/img/frr/next-hop-self.png" data-zoomable=""> </picture> </figure> </div> <p>To add the next-hop-self command on FRR routers, you can use the following commands (on router <code class="language-plaintext highlighter-rouge">R2</code>):</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>router# conf t
router(config)# router bgp 100
router(config-router)# neighbor 20.0.0.2 remote-as 100
router(config-router)# neighbor 20.0.0.2 next-hop-self
</code></pre></div></div> </article> </div> </div> <footer class="sticky-bottom mt-5"> <div class="container" style="text-align:center;"> © Copyright 2025 Deepak Gouda. <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer"> Template here!</a>. All images are my own. Last updated: February 06, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha256-l/1pMF/+J4TThfgARS6KwWrk/egwuVvhRzfLAMQ6Ds4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha256-SyTu6CwrfOhaznYZPoolVw2rxoY7lKYKQvqbtqN93HI=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script src="/assets/js/zoom.js"></script> <script src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>